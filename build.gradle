// Run at command line using 'gradle -q'

import groovy.json.*

defaultTasks 'build'


class JsonDocLocations {
	static String TEST = "./jsondocs_test"
	static String EXTJS_4_2_0 = "./jsondocs_ExtJS_4.2.0"
	static String TOUCH_4_2_1 = "./jsondocs_ExtJS_4.2.1"
	static String TOUCH_2_2_1 = "./jsondocs_Touch_2.2.1"
}


// Project-level extra properties
project.ext {
	config = new Config(
		libraryName: "Touch",
		libraryVersion: "2.2.1",
		jsonDocPath: JsonDocLocations.TOUCH_2_2_1,
		singleDefinition: true,
		useFullTyping: true,
		interfaceOnly: true,
		includePrivate: false,
		forceAllParamsToOptional: true,
		outputPath: "./target",
		omitOverrideComments: true
	)
}


// TASKS

/*
task wrapper( type: Wrapper ) {
	gradleVersion = '1.4'
}
*/

task initialize() << {
	Config config = project.config
	println " "
	println "Creating ${ config.libraryName } ${ config.libraryVersion } Definition File..."
	println "Using JSON docs from: ${ config.jsonDocPath }"
	println " "

}

task readFiles( dependsOn: initialize ) << {
	Config config = project.config
	LibraryProcessor processor = new LibraryProcessor( config: config )
	processor.init()

	def jsonDocPath = new File( config.jsonDocPath )
	def jsonDocCollection = files { jsonDocPath.listFiles() }
	def jsonDocFiles = jsonDocCollection.getFiles()
	processor.iterateFiles( jsonDocFiles )
}

task build( dependsOn: readFiles ) << {
	println " "
	println "Build complete"
	println " "
}
